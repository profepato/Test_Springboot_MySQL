# Test Springboot y MySQL con Maven
Basado en [este Ejemplo de página oficial](https://spring.io/guides/gs/accessing-data-mysql/).
## Ejecutar el siguiente script MySQL
```sql
CREATE DATABASE bd_usuarios;

USE bd_usuarios;

CREATE TABLE usuario(
    id INT AUTO_INCREMENT,
    nombre VARCHAR(100),
    correo VARCHAR(100),
    PRIMARY KEY(id)
);

INSERT INTO usuario VALUES(NULL, 'Pato Pérez Pinto', 'pato@gmail.com');

SELECT * FROM usuario;

CREATE USER 'springuser'@'localhost' IDENTIFIED BY '123456';
GRANT ALL ON bd_usuarios.* TO 'springuser'@'localhost';
```

## Crear proyecto Netbeans (Maven)
En netbeans se debe crear un proyecto Maven --> Java Application. Escoja el nombre que quiera.

## Añadir lo siguiente a archivo pom.xml
```xml
<parent>
    <groupId>org.springframework.boot</groupId>
    <artifactId>spring-boot-starter-parent</artifactId>
    <version>2.0.5.RELEASE</version>
</parent>
```
```xml
<dependencies>
    <!-- Proyecto web Springboot -->
    <dependency>
        <groupId>org.springframework.boot</groupId>
        <artifactId>spring-boot-starter-web</artifactId>
    </dependency>
        
     <!-- Use MySQL Connector-J -->
     <dependency>
         <groupId>mysql</groupId>
         <artifactId>mysql-connector-java</artifactId>
     </dependency>

      <!-- JPA Data (Lo usaremos para Repositorios, Entidades, Hibernate, etc...) -->
      <dependency>
          <groupId>org.springframework.boot</groupId>
          <artifactId>spring-boot-starter-data-jpa</artifactId>
      </dependency>
      
      <!-- Para hacer pruebas (No utilizado para este ejemplo) -->
      <dependency>
          <groupId>org.springframework.boot</groupId>
          <artifactId>spring-boot-starter-test</artifactId>
          <scope>test</scope>
      </dependency>
</dependencies>
```

## En netbeans...
Click secundario sobre el proyecto:
* Clean and build...
* Build with Dependencies

## Crear application.properties
Es en este archivo donde se le dan ciertas configuraciones al proyecto. 
La ubicación de este archivo, en el proyecto netbeans, es la siguiente: 
```
Other sources --> src/main/resources
```
IMPORTANTE!: en es esa ruta donde debe quedar ubicado dicho archivo. 
Crear archivo __application.properties__.

## application.properties
```
# none This is the default for MySQL, no change to the database structure.
# update Hibernate changes the database according to the given Entity structures.
# create Creates the database every time, but don’t drop it when close.
# create-drop Creates the database then drops it when the SessionFactory closes.

spring.jpa.hibernate.ddl-auto=update
spring.datasource.url=jdbc:mysql://localhost:3306/bd_usuarios
spring.datasource.username=springuser
spring.datasource.password=123456
```

## Usuario.java

Cambiar el paquete ```org.prez.springmysql.model;``` por el que estimes conveniente.
```java
package org.prez.springmysql.model;

import javax.persistence.Entity;
import javax.persistence.GeneratedValue;
import javax.persistence.GenerationType;
import javax.persistence.Id;

@Entity // This tells Hibernate to make a table out of this class
public class Usuario {
    @Id
    @GeneratedValue(strategy = GenerationType.AUTO)
    private Integer id;
    private String nombre;
    private String correo;

    public Integer getId() {
        return id;
    }

    public void setId(Integer id) {
        this.id = id;
    }

    public String getNombre() {
        return nombre;
    }

    public void setNombre(String nombre) {
        this.nombre = nombre;
    }

    public String getCorreo() {
        return correo;
    }

    public void setCorreo(String correo) {
        this.correo = correo;
    }

}

```

## UsuarioRepository.java
Cambiar el paquete ```org.prez.springmysql.model;``` por el que estimes conveniente.
```java 
package org.prez.springmysql.model;

import org.springframework.data.repository.CrudRepository;


// This will be AUTO IMPLEMENTED by Spring into a Bean called userRepository
// CRUD refers Create, Read, Update, Delete

public interface UsuarioRepository extends CrudRepository<Usuario, Integer> {

}

```

## UsuarioController.java
Cambiar el paquete ```org.prez.springmysql.model;``` por el que estimes conveniente.

```java 
package org.prez.springmysql.model;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Controller;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.RequestParam;
import org.springframework.web.bind.annotation.ResponseBody;

@Controller    // This means that this class is a Controller
@RequestMapping(path = "/usuarios") // This means URL's start with /demo (after Application path)
public class UsuarioController {

    @Autowired // This means to get the bean called userRepository
    // Which is auto-generated by Spring, we will use it to handle the data
    private UsuarioRepository usuarioRepository;

    @GetMapping(path = "/add") // Map ONLY GET Requests
    public @ResponseBody
    String addNewUser(@RequestParam String nombre,
             @RequestParam String correo) {
        // @ResponseBody means the returned String is the response, not a view name
        // @RequestParam means it is a parameter from the GET or POST request

        Usuario n = new Usuario();
        n.setNombre(nombre);
        n.setCorreo(correo);
        usuarioRepository.save(n);
        return "Saved";
    }

    @GetMapping(path = "/all")
    public @ResponseBody
    Iterable<Usuario> getAllUsers() {
        return usuarioRepository.findAll();// This returns a JSON or XML with the users
    }
    
    @GetMapping(path = "/delete")
    public @ResponseBody
    void delete(@RequestParam int id){
        Usuario u = new Usuario();
        u.setId(id);
        
        usuarioRepository.delete(u);
    }
}

```

## Aplicacion.java
Cambiar el paquete ```org.prez.springmysql.model;``` por el que estimes conveniente.
```java 
package org.prez.springmysql.model;

import org.springframework.boot.SpringApplication;
import org.springframework.boot.autoconfigure.SpringBootApplication;

@SpringBootApplication
public class Aplicacion {

    public static void main(String[] args) {
        SpringApplication.run(Aplicacion.class, args);
    }
}
```

